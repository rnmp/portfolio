---
import Layout from '../../layouts/Layout.astro';
import BlogPost from '../../layouts/BlogPost.astro';
import TypingTitle from '../../components/TypingTitle.astro';
import BlogContainer from '../../components/BlogContainer.astro';
import EmailForm from '../../components/EmailForm.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog')).sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime()
);

// Render the content for each post
const postsWithContent = await Promise.all(
  posts.map(async (post) => {
    const { Content } = await post.render();
    return {
      ...post,
      Content
    };
  })
);

---

<Layout 
  title="Rolando is typingâ€¦" 
  description="Blog posts and writings by Rolando Murillo" 
  backgroundVariant="typing"
>
  <BlogContainer>
    <TypingTitle />
    <EmailForm class="form-animate" />
    <div class="posts">
      {postsWithContent.map((post, index) => {
        const formattedDate = post.data.date.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          timeZone: 'UTC'
        });
        
        return (
          <BlogPost 
            title={post.data.title} 
            date={post.data.date} 
            description={post.data.description}
            slug={post.slug}
            class={`post-animate`}
            index={index}
          >
            <post.Content />
          </BlogPost>
        );
      })}
    </div>
  </BlogContainer>
</Layout>

<style>
  .posts {
    display: flex;
    flex-direction: column;
    gap: 3rem;
  }

  @media (max-width: 512px) {
    .posts {
      gap: 1rem;
    }
  }
</style>

<style is:global>
  .post-animate {
    opacity: 0;
    transform: translateY(20px);
    animation: postFadeInSlideUp 1.8s cubic-bezier(0.19, 1, 0.22, 1) forwards;
  }

  .post-animate[data-index="0"] {
    animation-delay: 0.3s;
  }

  .post-animate[data-index="1"] {
    animation-delay: 0.5s;
  }

  .post-animate[data-index="2"] {
    animation-delay: 0.7s;
  }

  .form-animate {
    opacity: 0;
    transform: translateY(20px);
    animation: postFadeInSlideUp 1.8s cubic-bezier(0.19, 1, 0.22, 1) forwards;
    animation-delay: 0.2s;
  }

  @keyframes postFadeInSlideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
